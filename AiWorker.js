var We=(()=>{var p=import.meta.url;return async function(r={}){var n,e=r,s,v,h=new Promise((t,o)=>{s=t,v=o}),g=typeof window=="object",w=typeof WorkerGlobalScope<"u",E=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string"&&process.type!="renderer";if(E){const{createRequire:t}=await Promise.resolve().then(function(){return Me});var d=t(import.meta.url)}var A={...e},b="./this.program",M=(t,o)=>{throw o},_="";function F(t){return e.locateFile?e.locateFile(t,_):_+t}var z,C;if(E){var $=d("fs"),Y=d("path");import.meta.url.startsWith("data:")||(_=Y.dirname(d("url").fileURLToPath(import.meta.url))+"/"),C=t=>{t=O(t)?new URL(t):t;var o=$.readFileSync(t);return o},z=async(t,o=!0)=>{t=O(t)?new URL(t):t;var i=$.readFileSync(t,o?void 0:"utf8");return i},!e.thisProgram&&process.argv.length>1&&(b=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),M=(t,o)=>{throw process.exitCode=t,o}}else(g||w)&&(w?_=self.location.href:typeof document<"u"&&document.currentScript&&(_=document.currentScript.src),p&&(_=p),_.startsWith("blob:")?_="":_=_.slice(0,_.replace(/[?#].*/,"").lastIndexOf("/")+1),w&&(C=t=>{var o=new XMLHttpRequest;return o.open("GET",t,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),z=async t=>{if(O(t))return new Promise((i,u)=>{var c=new XMLHttpRequest;c.open("GET",t,!0),c.responseType="arraybuffer",c.onload=()=>{if(c.status==200||c.status==0&&c.response){i(c.response);return}u(c.status)},c.onerror=u,c.send(null)});var o=await fetch(t,{credentials:"same-origin"});if(o.ok)return o.arrayBuffer();throw new Error(o.status+" : "+o.url)});var ee=e.print||console.log.bind(console),S=e.printErr||console.error.bind(console);Object.assign(e,A),A=null,e.arguments&&e.arguments,e.thisProgram&&(b=e.thisProgram);var N=e.wasmBinary,j,k=!1,B,D,T,O=t=>t.startsWith("file://");function re(){var t=j.buffer;e.HEAP8=B=new Int8Array(t),e.HEAP16=new Int16Array(t),e.HEAPU8=D=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAP32=new Int32Array(t),e.HEAPU32=T=new Uint32Array(t),e.HEAPF32=new Float32Array(t),e.HEAPF64=new Float64Array(t),e.HEAP64=new BigInt64Array(t),e.HEAPU64=new BigUint64Array(t)}function te(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)we(e.preRun.shift());q(Q)}function ne(){m.g()}function oe(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)ye(e.postRun.shift());q(K)}var R=0,W=null;function ae(t){R++,e.monitorRunDependencies?.(R)}function se(t){if(R--,e.monitorRunDependencies?.(R),R==0&&W){var o=W;W=null,o()}}function G(t){e.onAbort?.(t),t="Aborted("+t+")",S(t),k=!0,t+=". Build with -sASSERTIONS for more info.";var o=new WebAssembly.RuntimeError(t);throw v(o),o}var x;function ie(){return e.locateFile?F("Quoridor.wasm"):new URL("/assets/Quoridor-aLHVxZ2H.wasm",import.meta.url).href}function ce(t){if(t==x&&N)return new Uint8Array(N);if(C)return C(t);throw"both async and sync fetching of the wasm failed"}async function le(t){if(!N)try{var o=await z(t);return new Uint8Array(o)}catch{}return ce(t)}async function fe(t,o){try{var i=await le(t),u=await WebAssembly.instantiate(i,o);return u}catch(c){S(`failed to asynchronously prepare wasm: ${c}`),G(c)}}async function ue(t,o,i){if(!t&&typeof WebAssembly.instantiateStreaming=="function"&&!O(o)&&!E)try{var u=fetch(o,{credentials:"same-origin"}),c=await WebAssembly.instantiateStreaming(u,i);return c}catch(f){S(`wasm streaming compile failed: ${f}`),S("falling back to ArrayBuffer instantiation")}return fe(o,i)}function ve(){return{a:Se}}async function me(){function t(f,y){return m=f.exports,j=m.f,re(),se(),m}ae();function o(f){return t(f.instance)}var i=ve();if(e.instantiateWasm)return new Promise((f,y)=>{e.instantiateWasm(i,(P,H)=>{t(P),f(P.exports)})});x??=ie();try{var u=await ue(N,x,i),c=o(u);return c}catch(f){return v(f),Promise.reject(f)}}class pe{name="ExitStatus";constructor(o){this.message=`Program terminated with exit(${o})`,this.status=o}}var q=t=>{for(;t.length>0;)t.shift()(e)},K=[],ye=t=>K.unshift(t),Q=[],we=t=>Q.unshift(t);e.noExitRuntime;var he=t=>{G("OOM")},_e=t=>{D.length,he()},L={},ge=()=>b||"./this.program",I=()=>{if(!I.strings){var t=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:t,_:ge()};for(var i in L)L[i]===void 0?delete o[i]:o[i]=L[i];var u=[];for(var i in o)u.push(`${i}=${o[i]}`);I.strings=u}return I.strings},de=(t,o)=>{for(var i=0;i<t.length;++i)B[o++]=t.charCodeAt(i);B[o]=0},Pe=(t,o)=>{var i=0;return I().forEach((u,c)=>{var f=o+i;T[t+c*4>>2]=f,de(u,f),i+=u.length+1}),0},Ae=(t,o)=>{var i=I();T[t>>2]=i.length;var u=0;return i.forEach(c=>u+=c.length+1),T[o>>2]=u,0},Ee=t=>{M(t,new pe(t))},Te=(t,o)=>{Ee(t)},Re=Te,He=[null,[],[]],X=typeof TextDecoder<"u"?new TextDecoder:void 0,Ue=(t,o=0,i=NaN)=>{for(var u=o+i,c=o;t[c]&&!(c>=u);)++c;if(c-o>16&&t.buffer&&X)return X.decode(t.subarray(o,c));for(var f="";o<c;){var y=t[o++];if(!(y&128)){f+=String.fromCharCode(y);continue}var P=t[o++]&63;if((y&224)==192){f+=String.fromCharCode((y&31)<<6|P);continue}var H=t[o++]&63;if((y&240)==224?y=(y&15)<<12|P<<6|H:y=(y&7)<<18|P<<12|H<<6|t[o++]&63,y<65536)f+=String.fromCharCode(y);else{var Z=y-65536;f+=String.fromCharCode(55296|Z>>10,56320|Z&1023)}}return f},be=(t,o)=>{var i=He[t];o===0||o===10?((t===1?ee:S)(Ue(i)),i.length=0):i.push(o)},Fe=(t,o,i,u)=>{for(var c=0,f=0;f<i;f++){var y=T[o>>2],P=T[o+4>>2];o+=8;for(var H=0;H<P;H++)be(t,D[y+H]);c+=P}return T[u>>2]=c,0},Se={c:_e,d:Pe,e:Ae,a:Re,b:Fe},m=await me();m.g,e._generate_legal_pawn_moves=m.i,e._generate_fully_legal_vertical_fence_moves=m.j,e._generate_fully_legal_horizontal_fence_moves=m.k,e._print_state=m.l,e._make_move=m.m,e._unmake_move=m.n,e._win_check=m.o,e._get_best_move_iterative_deepening=m.p,e._get_state_ptr=m.q,e._malloc=m.r,e._get_move_ptr=m.s,e._new_state_ptr=m.t,e._free=m.u;function V(){if(R>0){W=V;return}if(te(),R>0){W=V;return}function t(){e.calledRun=!0,!k&&(ne(),s(e),e.onRuntimeInitialized?.(),oe())}e.setStatus?(e.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>e.setStatus(""),1),t()},1)):t()}if(e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return V(),n=h,n}})(),l=(p=>(p[p.None=0]="None",p[p.VerticalFence=1]="VerticalFence",p[p.HorizontalFence=2]="HorizontalFence",p[p.Pawn=3]="Pawn",p))(l||{});class J{moves;constructor(){this.moves=new Array(81*3),this.moves.fill(!1)}add(r){this.moves[this.hash(r)]=!0}contains(r){return r.moveType===l.None?!1:this.moves[this.hash(r)]}hash(r){return(r.moveType-1)*81+r.row*9+r.col%9}}const a=await We();class Ie{static newState(){const r=a._new_state_ptr(),n=this.readWasmState(r);return a._free(r),n}static makeMove(r,n){const e=this.stateToWasm(r),s=this.moveToWasm(n);return a._make_move(e,s),r=this.readWasmState(e),a._free(e),a._free(s),r}static unMakeMove(r,n){const e=this.stateToWasm(r),s=this.moveToWasm(n);return a._unmake_move(e,s),r=this.readWasmState(e),a._free(e),a._free(s),r}static getAiMove(r,n){const e=this.stateToWasm(r),s=a._get_move_ptr();a._get_best_move_iterative_deepening(s,e,n);const v=this.readWasmMove(s,r);return a._free(e),a._free(s),v}static winCheck(r){const n=this.stateToWasm(r),e=a._win_check(n);return a._free(n),e}static getLegalMoves(r,n){const e=a._generate_legal_pawn_moves(n),s=a._generate_fully_legal_vertical_fence_moves(n),v=a._generate_fully_legal_horizontal_fence_moves(n),h=r.playerToMove==1?r.playerOneRow:r.playerTwoRow,g=r.playerToMove==1?r.playerOneCol:r.playerTwoCol,w=this.pawnMovesFromWasm(e,h,g),E=this.fenceMovesFromWasm(s,v),d=new J;for(const A of w)d.add(A);for(const A of E)d.add(A);return d}static stateToWasm(r){const n=a._get_state_ptr();let e=0;return a.HEAPU32[n+e>>2]=Number(r.verticalFences&0xffffffffn),a.HEAPU32[n+e+4>>2]=Number(r.verticalFences>>32n),e+=8,a.HEAPU32[n+e>>2]=Number(r.horizontalFences&0xffffffffn),a.HEAPU32[n+e+4>>2]=Number(r.horizontalFences>>32n),e+=8,a.HEAPU8[n+e++]=r.playerOneRow,a.HEAPU8[n+e++]=r.playerOneCol,a.HEAPU8[n+e++]=r.playerTwoRow,a.HEAPU8[n+e++]=r.playerTwoCol,a.HEAPU8[n+e++]=r.playerOneFenceCount,a.HEAPU8[n+e++]=r.playerTwoFenceCount,a.HEAPU8[n+e++]=r.playerToMove,n}static readWasmState(r){let n=0,e=a.HEAPU32[r+n>>2],s=a.HEAPU32[r+n+4>>2];const v=BigInt(s)<<32n|BigInt(e);n+=8,e=a.HEAPU32[r+n>>2],s=a.HEAPU32[r+n+4>>2];const h=BigInt(s)<<32n|BigInt(e);n+=8;const g=a.HEAPU8[r+n++],w=a.HEAPU8[r+n++],E=a.HEAPU8[r+n++],d=a.HEAPU8[r+n++],A=a.HEAPU8[r+n++],b=a.HEAPU8[r+n++],M=a.HEAPU8[r+n++],_=new J,F={verticalFences:v,horizontalFences:h,playerOneRow:g,playerOneCol:w,playerTwoRow:E,playerTwoCol:d,playerOneFenceCount:A,playerTwoFenceCount:b,playerToMove:M,legalMoves:_};return F.legalMoves=this.getLegalMoves(F,r),F}static moveToWasm(r){const n=a._get_move_ptr();let e=0;if(r.moveType===l.Pawn){const s=r.row-r.fromRow,v=r.col-r.fromCol,h=U.getMove(s,v);h===void 0&&console.error(`Invalid pawn move: (${s}, ${v}).`),a.HEAPU32[n+e>>2]=h}else if(r.moveType===l.VerticalFence||r.moveType===l.HorizontalFence){const s=1n<<BigInt(r.row*8+r.col);a.HEAPU32[n+e>>2]=Number(s&0xffffffffn),a.HEAPU32[(n+e>>2)+1]=Number(s>>32n)}else r.moveType===l.None?(a.HEAPU32[n+e>>2]=0,a.HEAPU32[(n+e>>2)+1]=0):console.error(`Invalid move type: ${r.moveType}.`);return e+=8,a.HEAPU32[n+e>>2]=r.moveType,e+=4,a.HEAP32[n+e>>2]=0,n}static readWasmMove(r,n){let e=8;const s=a.HEAPU16[r+e>>1];switch(e=0,s){case l.None:return{moveType:s,row:-1,col:-1};case l.Pawn:{const v=n.playerToMove===1?n.playerOneRow:n.playerTwoRow,h=n.playerToMove===1?n.playerOneCol:n.playerTwoCol,g=a.HEAPU32[r+e>>2],w=U.getDif(g);if(w===void 0)throw Error(`Illegal PawnMoveType: ${g}`);return{moveType:s,row:v+w[0],col:h+w[1],fromRow:v,fromCol:h}}case l.VerticalFence:case l.HorizontalFence:{const v=a.HEAPU32[r+e>>2],h=a.HEAPU32[r+e+4>>2];let g=Math.clz32(h);g===32&&(g+=Math.clz32(v));const w=63-g;return{moveType:s,row:Math.floor(w/8),col:w%8}}}}static pawnMovesFromWasm(r,n,e){const s=new Array;return 1&r&&s.push({moveType:l.Pawn,row:n-1,col:e}),2&r&&s.push({moveType:l.Pawn,row:n,col:e+1}),4&r&&s.push({moveType:l.Pawn,row:n+1,col:e}),8&r&&s.push({moveType:l.Pawn,row:n,col:e-1}),16&r&&s.push({moveType:l.Pawn,row:n-2,col:e}),32&r&&s.push({moveType:l.Pawn,row:n,col:e+2}),64&r&&s.push({moveType:l.Pawn,row:n+2,col:e}),128&r&&s.push({moveType:l.Pawn,row:n,col:e-2}),256&r&&s.push({moveType:l.Pawn,row:n-1,col:e+1}),512&r&&s.push({moveType:l.Pawn,row:n-1,col:e-1}),1024&r&&s.push({moveType:l.Pawn,row:n+1,col:e+1}),2048&r&&s.push({moveType:l.Pawn,row:n+1,col:e-1}),s}static fenceMovesFromWasm(r,n){const e=new Array;for(let s=0n;s<64n;s++){const v=1n<<s;(v&r)!=0n&&e.push({moveType:l.VerticalFence,row:Math.floor(Number(s/8n)),col:Number(s%8n)}),(v&n)!=0n&&e.push({moveType:l.HorizontalFence,row:Math.floor(Number(s/8n)),col:Number(s%8n)})}return e}}class U{static entries=[[-1,0,1],[0,1,2],[1,0,4],[0,-1,8],[-2,0,16],[0,2,32],[2,0,64],[0,-2,128],[-1,1,256],[-1,-1,512],[1,1,1024],[1,-1,2048]];static getMove(r,n){return this.difToMove.get(this.toKey(r,n))}static getDif(r){return this.moveToDif.get(r)}static toKey(r,n){return`${r},${n}`}static difToMove=new Map(U.entries.map(([r,n,e])=>[U.toKey(r,n),e]));static moveToDif=new Map(U.entries.map(([r,n,e])=>[e,[r,n]]))}addEventListener("message",p=>{const{gameState:r,difficulty:n}=p.data,e=Ie.getAiMove(r,n);postMessage({type:"result",move:e})});postMessage({type:"ready"});var Me=Object.freeze({__proto__:null});
